<?xml version="1.0" encoding="Shift_JIS"?>
<project
    xmlns:j="jelly:core"
    xmlns:ant="jelly:ant"
    xmlns:maven="jelly:maven"
    default="jar:jar">

  <postGoal name="test:compile">
    <copy overwrite="true" todir="target">
      <fileset dir="src" includes="testwebapp/**"/>
    </copy>
    <mkdir dir="target/testwebapp/WEB-INF/classes"/>
    <copy overwrite="true" todir="target/testwebapp/WEB-INF/classes">
      <fileset dir="target/test-classes" includes="**"/>
    </copy>
  </postGoal>

  <postGoal name="jar:jar">
    <ant:jar jarfile="target/${pom.artifactId}-lite-${pom.currentVersion}.jar"
         basedir="${maven.build.dest}"
         includes="javax/servlet/*,javax/servlet/http/*,javax/servlet/resources/web-app*.dtd,winstone/*">
      <manifest>
        <attribute name="Main-Class" value="${maven.jar.mainclass}"/>
      </manifest>
    </ant:jar>
  </postGoal>
  
  <goal name="release.sourceforge" prereqs="jar:jar,release.archive">
    <ant:ftp server="upload.sourceforge.net"
             remotedir="incoming"
             userid="anonymous"
             password=""
             verbose="yes"
             passive="yes">
      <ant:fileset file="target/${pom.artifactId}-${pom.currentVersion}.jar"/>
      <ant:fileset file="target/${pom.artifactId}-lite-${pom.currentVersion}.jar"/>
      <ant:fileset file="target/winstone-src-${release.name}.tar.gz"/>
    </ant:ftp>
  </goal>

  <goal name="release.archive">
    <mkdir dir="target/source-release"/>
    <ant:tar tarfile="target/source-release/winstone-src-${pom.currentVersion}.tar" 
             basedir="." 
             includes="**/*"
             excludes="target/**,build-eclipse/**"/>
    <ant:gzip src="target/source-release/winstone-src-${pom.currentVersion}.tar" 
              zipfile="target/source-release/winstone-src-${pom.currentVersion}.tar.gz"/>
    <delete file="target/source-release/winstone-src-${pom.currentVersion}.tar"/>
  </goal>
</project>
