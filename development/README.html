<html>
<head>
  <title>Winstone Servlet Container</title>
</head>
<body>
<center><h1>Winstone Servlet Container v0.3.1</h1></center>

  <center><a href="http://sourceforge.net/project/showfiles.php?group_id=98922">Downloads</a></center>
  <hr width="90%" size="1" noshade="true"/>

<br/>
<center>
  <table border="0" width="90%">
    <tr>
      <td>
  <p>This is an alpha release of the Winstone Servlet Container.  The homepage for this project is 
    at 'http://winstone.sourceforge.net'</p>

  <p>Author: Rick Knowles (contact details below)</p>

<h2>What is Winstone ?</h2>

  <p>Winstone is a servlet container that was written out of a desire to provide servlet
    functionality without the bloat that full J2EE compliance introduces.</p>

  <p>It is not intended to be a completely fully functional J2EE style servlet 
    container (by this I mean supporting extraneous APIs unrelated to Servlets, such as 
    JNDI, JavaMail, EJBs, etc) - this is left to Tomcat, Jetty, Resin, JRun, Weblogic et al. </p>

  <p>Sometimes you want just a simple servlet container - without all the other junk - that just goes. 
    This is where Winstone is best suited.</p>

  <p>The original goals in writing Winstone were:</p>
    <ul>
      <li>Supply fast, reliable servlet container functionality for a single webapp per server</li>
      <li>Keep the size of the core distribution jar as low as possible (currently 135KB)</li>
      <li>Keep configuration files to an absolute minimum, using command line options to 
        optionally override sensible compiled in defaults. </li>
      <li>Eventually compile with GCJ to make a 3-4Meg windows exe for local development/deployment 
        of servlets. This has not happened yet, because of some GCJ class loading problems.</li>
      <li>Optionally support JSP compilation using Apache's Jasper. (http://jakarta.apache.org)</li>
    </ul>

<h2>Using Winstone</h2>

  <p>If you want to build from source code, you will need to download and install Apache Ant. The
    following instructions assume you have already installed Ant and have the ant shell script in
    your path (to get Ant, see http://ant.apache.org/).</p>

  <p>To build Winstone, unpack the tree:</p>

    &nbsp;&nbsp;<code>tar zxf winstone_src_v0.3.1.tar.gz</code>

  <p>Then build it:</p>

    &nbsp;&nbsp;<code>cd winstone/development</code>
    &nbsp;&nbsp;<code>ant dist</code>

  <p>To run it:</p>

    &nbsp;&nbsp;<code>java -jar ../dist/winstone_v0.3.1.jar --webroot=&lt;location of webroot&gt; </code> (+ other options)

  <p> - OR - </p>

    &nbsp;&nbsp;<code>java -jar ../dist/winstone_v0.3.1.jar --warfile=&lt;location of warfile&gt;</code> (+ other options)

  <p>The winstone.jar file will be in the winstone/dist directory after the build is complete.</p>

<h2>Command-line options:</h2>

  <pre>
Syntax:
  java -jar winstone_v0.3.1.jar [--option=value] [--option=value] etc

Required options: either --webroot OR --warfile
   --webroot                = set document root folder.
   --warfile                = set location of warfile to extract from.

Other options:
   --config                 = load configuration properties from here(if supplied).
   --prefix                 = add this prefix to all URLs. (eg http://host/prefix/etc) Default is none
   --debug                  = set the level of debug msgs (1-9). Default is 5 (INFO level)

   --httpPort               = set the http listening port. -1 to disable, Default is 8080
   --httpDoHostnameLookups  = enable host name lookups on http connections (true/false). Default is true
   --ajp13Port              = set the ajp13 listening port. -1 to disable, Default is 8009
   --controlPort            = set the shutdown/control port. -1 to disable, Default disabled

   --handlerCountStartup    = set the no of worker threads to spawn at startup. Default is 5
   --handlerCountMax        = set the max no of worker threads to allow. Default is 300
   --handlerCountMaxIdle    = set the max no of idle worker threads to allow. Default is 50

   --directoryListings      = enable directory lists (true/false). Default is true
   --useJasper              = enable jasper JSP handling (true/false). Default is false
   --useWinstoneClassLoader = enable WebApp classLoader (true/false). Default is true
   --useInvoker             = enable the servlet invoker (true/false). Default is false
   --invokerPrefix          = set the invoker prefix. Default is /servlet/
   --useServletReloading    = enable servlet reloading (true/false). Default is false\n\
   --usage / --help         = show this message</pre>

<h2>Configuration file</h2>

  <p>You don't really need a config file, but sometimes it's handy to be able to use the same settings
    each time without running through the command history.</p>

  <p>Winstone looks for a config file winstone.properties in the current directory (or in the location 
    specified with --config) at startup. It loads the properties in this file, overrides them with any
    supplied command line properties, and then starts itself.</p>

  <p>This is just intended as a handy feature for people who want to cache regular startup options, rather
    than using batch files.</p>

<h2>Why is it called Winstone ?</h2>

  <p>The short version (because the long version is way too politically incorrect) is as follows: </p>

  <p>Winstone is the name of a rather large Jamaican man a friend of mine met one night, while 
    he was out clubbing in the Roppongi area of Tokyo one night. He (my friend) was a little 
    liquored up at the time, and when Winstone suggested they head to "this really cool club" 
    he knew, he didn't think anything was wrong. It wasn't until Winstone led him down a dark 
    stairwell and dropped his trousers that my friend clued in and ran like hell.</p>

  <p>It was too good a story to let die, so I named this project Winstone so that said friend 
    will continue to be reminded of it. Heheheh ....</p>

<h2>Caveats</h2>

  <p>As a result of the design goals, there are some things Winstone doesn't do (at least 
    not yet).</p>
  <ul>
    <li>There is no HTTP authentication/security model at all (yet). This is big goal no 1 for 
      next release.</li>
    <li>There is no clustering support (yet). This will be implemented eventually by allowing Winstone
      instances to transfer sessions on request over the controlPort. This is a longer term goal 
      though.</li>
    <li>HttpSession support is cookie-based only (no URL rewriting). I don't see any reason to 
      build this, since I've never come across anyone that actually uses URL rewriting. </li>
    <li>The messages are all in English only. These have been updated to use resource 
      bundles, but no translations yet.</li>
  </ul>

<h2>Recent additions</h2>

  <p>New features in v0.3.1:</p>

  <ul>
    <li>Implemented the <b>&lt;error-page&gt;</b> directive</li>
    <li>Added object pools for request/response objects for performance reasons</li>
    <li>The handler pools are now controllable via startup properties</li>
    <li><b>Servlet reloading</b> is now supported (optionally - include <code>--useServletReloading=true</code> at startup)</li>
  </ul>

  <p>New features in v0.3:</p>

  <ul>
    <li>The request handler threads now use <b>monitors</b>, which allows them to exist beyond a single
      request/response cycle. The benefit here is performance - it removes a serious bottleneck.</li>
    <li><b>WAR files</b> are now supported via the --warfile attribute. If you specify a warfile in this 
      manner, it will be automatically extracted by the container to a temp directory, overwriting
      only files that are older than the archive date.</li>
    <li><b>Servlet attribute, session, and context listeners</b> (Servlet spec v2.3) are now fully supported. 
      The HttpSessionActivationListener class will be fully supported once the session transfer
      is implemented.</li>
    <li><b>Servlet Filters</b> (Servlet spec v2.3) are now fully supported.</li>
    <li>There is now an <b>AJP13 connector</b>, which means Winstone will now work behind Apache/IIS/etc
      using Tomcat's mod_jk. Try it out and see ... there's a section below on using the mod_jk connector.</li>
  </ul>

<h2>Security Warning</h2>

  <p>If you enable the controlPort, be aware that any connection on that port whatsoever will 
    trigger a server shutdown. As shutdown is the only purpose of the control port at the moment, 
    it seemed fair to leave like this. As the admin features grow, I'll alter this.</p>

  <p>The controlPort is disabled by default. If you choose not to enable it, the only way to shut
    Winstone down is to kill the process (either by Ctrl-C or kill command). The reason I left it 
    disabled by default was because I don't like the idea of an nmap scan inadvertedly shutting 
    Winstone down.</p>

<h2>License</h2>

  <p>The Web-App DTD files (web-app_2_2.dtd &amp; web-app_2_3.dtd in the src/javax/servlet/resources 
    folder) and the lib/jsp-servlet.jar files are covered by the Apache software license, as 
    described at the top of each file, and at http://www.apache.org/licenses/LICENSE</p>

  <p>All other files are covered by the GNU Public License, as described in LICENSE.txt.</p>

<h2>Contacting the Author</h2>

  <p>You can contact me through the Winstone development list at sourceforge 
    (winstone-devel@lists.sourceforge.net).  If you have any general comments or questions 
    about Winstone please mail me on that list - I'll try to start a faq soon.</p>

  <p>I'm open to help from anyone who's willing to help me meet the above goals for Winstone.
    Just mail me at the list (winstone-devel AT lists DOT sourceforge DOT net)</p>

<h2>JSPs (aka using with Jasper)</h2>

  <p>Winstone does support JSPs, using Apache's Jasper JSP compiler. Thanks to a rather clever 
    design by the Jasper team, this was much less work than I expected - well done Jasper guys.</p>

  <p>In order to turn on JSP compilation, you need to include the following additional jars in 
    the startup classpath:</p>
    <ul>
      <li><b>jsp-servlet.jar</b> - 
         This is a stripped down version of the tomcat servlet.jar. I removed 
         the javax/servlet and javax/servlet/http sections from the original 
         servlet.jar though, to avoid conflicts with Winstone's api classes. 
         This is in the Winstone development/lib folder.</li>

      <li><b>jasper-compiler, jasper-runtime.jar, ant.jar</b> - 
         Not supplied. You can get this from the standard Tomcat binary download location. 
         Just download the latest Tomcat, and copy these three files into the startup classpath 
         for Winstone. They will be in the tomcat_home/common/lib folder.</li>

      <li><b>tools.jar</b> - 
         You should already have this in the <java_home>/lib folder of your jdk. You'll need
         to add this, cause the ant javac compile task uses it, and this is needed to turn the
         generated .java files into .class files at runtime.</li>
    </ul>

  <p>Tomcat is available at http://jakarta.apache.org/tomcat/index.html - but please note that the
    license for Tomcat is not the same as Winstone. Please read carefully before packaging.</p>

<h2>Connecting to Apache</h2>

  <p>These instructions are for beginners: if you know your way around Apache and Tomcat, you'll know what's going on here.</p>

  <p>Download and install Apache for your platform (and obviously Winstone too), then follow these steps:</p>

  <ol>
    <li>Download mod_jk2.dll/so into the apache modules directory</li>
    <li>Add the following to the apache conf file (httpd.conf): </li>
<pre>
      LoadModule jk2_module modules/mod_jk2.dll

      &lt;Location "/&lt;Winstone Prefix&gt;/*"&gt;
        JkUriSet worker ajp13:localhost:8009 
      &lt;/Location&gt;
</pre>
    <li>Create a new file called workers2.properties in the apache conf directory, with the following contents</li>
<pre>
# only in the beginning. In production comment out
[logger.apache2]
level=DEBUG

[shm]
file=c:/program files/apache group/apache2/logs/shm.file
size=1048576

# Example socket channel, override port and host.
[channel.socket:localhost:8009]
port=8009
host=127.0.0.1

# define the worker
[ajp13:localhost:8009]
channel=channel.socket:localhost:8009
</pre>
    <li>Start up Winstone and Apache and try connecting to the your webapp on the apache port, with the winstone 
      prefix. If it doesn't work, try looking at the apache error.log file for hints. If you get hex dumps, mail
      them to the winstone-devel list, together with any stack traces winstone generated.</li>
  </ol>

  <p>Please note this is not an optimal configuration for production uses. This is provided purely for those
    who need some help to get started. Read the mod_jk documentation with Tomcat for more detailed info.</p>

<h2>GCJ compilation</h2>

  <p>I've had a little bit of success with this recently. Under the gcj folder in the source
    distribution there is a Makefile that I used to build Winstone to a native binary. It worked
    quite well - and to my naked eye, looked like lightning for static pages - except for 
    one problem: class loading.</p>

  <p>The problem is this: When you call "Class.forName(className)", the effect should be the 
    same as calling "Class.forName(className, true, Thread.currentThread().getContextClassLoader())", and 
    the short answer is that in recent GCJ versions, it's not.</p>

  <p>Recent GCJ versions use a "bogus" method to find the current class loader (their words 
    not mine). Basically GCJ generates a stack trace and walks back over it, trying to find a 
    class loader within recent memory. If none is found, it uses the system class loader.</p>

  <p>In most cases this is fine, but in a servlet container this is no good, because unless you
    have a webapp that has no WEB-INF/lib and WEB-INF/classes folders, you need to use a class
    loader other than the system classloader.</p>

  <p>One possible solution is to compile the webapp classes and Winstone into native binary format.
    This works except that if the servlet container tries to use another class loader anyway, you
    still have problems with which loader loaded which classes.</p>

  <p>To get around this, I have included an option "--useWinstoneClassLoader=false". This allows
    you to disable the webapp class loader, and operate entirely with a single class loader. This
    works ok for servlet-only environments, but it seems Jasper uses it's own classloader, so 
    you may still have problems in jsp + GCJ-compiled-Winstone environments.</p>

  <p>NOTE: The Makefile included uses Crimson as an XML parser, which has since been replaced 
    with the GNU XML parser due to License conflicts.</p>
      </td>
    </tr>
  </table>
  </center>
  <hr width="90%" size="1" noshade="true"/>
  <center>
    <a href="http://sourceforge.net"><img src="http://sourceforge.net/sflogo.php?group_id=98922&amp;type=5" width="210" height="62" border="0" alt="SourceForge.net Logo" /></a>
  </center>
</body>
</html>